<mat-progress-bar color="accent" class="progressbar-top" *ngIf="sending" mode="indeterminate"></mat-progress-bar>
<div class="task-dialog-wrapper" fxFlex fxLayout="column">
  <div mat-dialog-title fxLayout="row">
    <mat-icon matTooltip="Overdue" *ngIf="overdue && !sticker_check && task.taskType == 'linked'"
              class="pointer alert-icon margin">add_alert
    </mat-icon>
    <mat-icon matTooltip="Completed" *ngIf="sticker_check && task.taskType == 'linked'"
              class="pointer check-icon margin">check
    </mat-icon>
    <span fxFlex>{{task.taskType == 'linked' ? 'Update Task' : 'Create Task'}}</span>
    <mat-icon (click)="closeDialog()" class="pointer">close</mat-icon>
  </div>

  <mat-dialog-content>

  </mat-dialog-content>
  <div>
    <form fxFlex fxLayout="column">
      <div fxLayout="row">
        <i class="fas fa-font margin offset-top-fa-icon" fxFlex="5"></i>
        <mat-form-field fxFlex>
          <input type="text" name="titleSelect" matInput [(ngModel)]="taskTitle" [matAutocomplete]="autocompleteTitle"
                 placeholder="Task Title" required>
          <mat-autocomplete #autocompleteTitle="matAutocomplete">
            <mat-option *ngFor="let title of filteredTitleSuggestions" [value]="title">{{title}}</mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>

      <div fxLayout="row">
        <mat-icon class="margin offset-top-mat-icon" fxFlex="5">dashboard</mat-icon>
        <mat-form-field fxFlex>
          <mat-select name="board-select" [(ngModel)]="task.board" [disabled]="task.taskType == 'linked'"
                      required placeholder="Trello Board">
            <mat-option *ngFor="let board of boards; let b = index"
                        [value]="task.taskType == 'suggested' ? board : task.board"
                        (onSelect)="task.taskType == 'suggested' ? onSelectBoard(board): ''">
              {{board.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div fxLayout="row">
        <mat-icon class="margin offset-top-mat-icon" *ngIf="task.board" fxFlex="5">view_list</mat-icon>
        <mat-form-field fxFlex>
          <mat-select name="list-select" [(ngModel)]="task.list" *ngIf="task.board"
                      [disabled]="task.taskType == 'linked'" required placeholder="Trello List">
            <mat-option *ngFor="let list of task.board.lists" [value]="task.taskType == 'linked'? task.list : list">
              {{task.taskType == 'linked' ? task.list.name : list.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div fxLayout="row" *ngIf="task.board">
        <div fxLayoutAlign="start center" fxFlex>
          <mat-icon class="margin" [class.alert-icon]="overdue && !sticker_check && task.taskType == 'linked'"
                    fxFlex="5">
            date_range
          </mat-icon>
          <mat-form-field fxFlex>
            <input name="date" matInput placeholder="Due Date" [(ngModel)]="task.date" [matDatepicker]="picker">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
      <div fxLayout="row" *ngIf="task.board">
        <mat-icon class="margin offset-top-mat-icon" fxFlex="5">person</mat-icon>
        <mat-form-field fxFlex>
          <mat-select class="margin" placeholder="Assignees" [(ngModel)]="currMember" name="member"
                      (onClose)="currMember = ''" fxFlex>
            <mat-option><i>Unassigned</i></mat-option>
            <mat-option *ngFor="let member of task.possibleMembers; let i = index" [value]="member"
                        (onSelect)="addMember(member, i)">
              {{member.fullName}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <div fxLayout="row" fxLayoutAlign="start center">
          <div *ngFor="let member of task.selectedMembers; let i = index" [matTooltip]="member.fullName"
               fxLayout="row" fxLayoutWrap="wrap" fxLayoutAlign="center center" class="member-initials">
            <span>{{member.initials}}</span>
            <mat-icon (click)="deleteMember(member, i)">close</mat-icon>
          </div>
        </div>
      </div>
      <div fxLayout="row">
        <i class="fas fa-align-left margin offset-top-fa-icon" fxFlex="5" fxFlexAlign="start center"></i>
        <mat-form-field fxFlex>
          <textarea matInput type="text" class="text-area" name="task-description" placeholder="Task Description"
                    maxRows="10" [(ngModel)]="task.desc" value="task.desc" rows="10" fxFlex></textarea>
        </mat-form-field>
      </div>
    </form>
  </div>
  <mat-dialog-actions>
    <button mat-submit mat-raised-button color="primary" [disabled]="sending || !task.list" (click)="createTask()"
            *ngIf="task.taskType == 'suggested'">
      <i class="fas fa-plus margin"></i>Create Task
    </button>
    <button mat-submit mat-raised-button color="primary" [disabled]="sending" (click)="updateTask()"
            *ngIf="task.taskType == 'linked'">
      <i class="fas fa-check margin"></i>Update Task
    </button>
    <button mat-submit mat-raised-button color="primary" [disabled]="sending"
            *ngIf="task.status != 'empty' && task.taskType == 'linked'" (click)="updateTask('close')">
      <mat-icon class="margin">archive</mat-icon>
      Archive Task
    </button>
    <button mat-submit mat-raised-button color="warn" [disabled]="sending" (click)="unlinkTask()"
            *ngIf="task.taskType == 'linked'">
      <i class="fas fa-unlink margin"></i>Unlink Task
    </button>
    <img src="/assets/img/trello.gif" class="trello-icon">
  </mat-dialog-actions>
</div>
